<%# Mobile Menu (visible on mobile/tablet) %>
<%= render "layouts/mobile_menu" %>

<%# Desktop Menu (hidden on mobile) %>
<header class="hidden lg:block bg-emerald-700 text-white">
  <nav class="h-16 flex justify-between items-center w-[96%] mx-auto">
    <!-- League Selector (Left Side) -->
    <div class="relative" data-controller="dropdown">
      <button
        type="button"
        data-dropdown-target="button"
        data-action="click->dropdown#toggle"
        aria-expanded="false"
        aria-haspopup="true"
        aria-label="Select league"
        class="flex items-center gap-2 px-3 py-2 rounded-md hover:bg-emerald-600 transition-colors focus:outline-none focus:ring-2 focus:ring-lime-400 focus:ring-offset-2 focus:ring-offset-emerald-700"
      >
        <span class="font-semibold">
          <% if current_league %>
            <%= current_league.name %>
          <% else %>
            All Leagues
          <% end %>
        </span>
        <svg
          class="chevron w-4 h-4 transition-transform duration-200"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
        </svg>
      </button>

      <!-- Dropdown Menu -->
      <div
        data-dropdown-target="menu"
        role="menu"
        aria-hidden="true"
        class="hidden absolute top-full left-0 mt-2 w-56 bg-white rounded-md shadow-xl border border-gray-200 py-1 z-50"
      >
        <%= link_to leagues_path, class: dropdown_item_classes(active: current_league.nil?) do %>
          <div class="flex items-center justify-between">
            <span>All Leagues</span>
            <% unless current_league %>
              <svg class="w-4 h-4 text-emerald-600" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
              </svg>
            <% end %>
          </div>
        <% end %>
        <div class="border-t border-gray-200 my-1"></div>
        <% all_leagues.each do |league| %>
          <%= link_to league_standings_path(league), class: dropdown_item_classes(active: current_league&.id == league.id) do %>
            <div class="flex items-center justify-between">
              <span><%= league.name %></span>
              <% if current_league&.id == league.id %>
                <svg class="w-4 h-4 text-emerald-600" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                </svg>
              <% end %>
            </div>
          <% end %>
        <% end %>
      </div>
    </div>

    <!-- Middle Navigation -->
    <div class="">
      <ul class="flex items-center gap-6">
        <li>
          <%= render "layouts/menu_item", 
              label: "Classificação", 
              path: menu_path_for(:classificacao),
              active: menu_item_active?(:classificacao) %>
        </li>
        <li>
          <%= render "layouts/menu_item", 
              label: "Tabela", 
              path: menu_path_for(:tabela),
              active: menu_item_active?(:tabela) %>
        </li>
        <li class="relative" data-controller="dropdown">
          <button
            type="button"
            data-dropdown-target="button"
            data-action="click->dropdown#toggle"
            aria-expanded="false"
            aria-haspopup="true"
            aria-label="Ranking menu"
            class="flex items-center gap-1 hover:text-lime-300 transition-colors focus:outline-none focus:ring-2 focus:ring-lime-400 focus:ring-offset-2 focus:ring-offset-emerald-700 <%= 'border-b-2 border-lime-400' if menu_item_active?(:ranking) %>"
          >
            Ranking
            <svg
              class="chevron w-3 h-3 transition-transform duration-200"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
          </button>
          <div
            data-dropdown-target="menu"
            role="menu"
            aria-hidden="true"
            class="hidden absolute top-full left-0 mt-2 w-40 bg-white rounded-md shadow-xl border border-gray-200 py-1 z-50"
          >
            <%= link_to menu_path_for(:pontos), class: dropdown_item_classes(active: menu_item_active?(:pontos)) do %>
              Pontos
            <% end %>
          </div>
        </li>
        <li>
          <%= render "layouts/menu_item", 
              label: "Temporadas", 
              path: menu_path_for(:temporadas),
              active: menu_item_active?(:temporadas) %>
        </li>
        <li>
          <%= render "layouts/menu_item", 
              label: "Times", 
              path: menu_path_for(:times),
              active: menu_item_active?(:times) %>
        </li>
      </ul>
    </div>

    <!-- User Menu (Right Side) -->
    <div class="relative" data-controller="dropdown">
      <button
        type="button"
        data-dropdown-target="button"
        data-action="click->dropdown#toggle"
        aria-expanded="false"
        aria-haspopup="true"
        class="flex items-center justify-center w-10 h-10 rounded-full bg-emerald-600 hover:bg-emerald-500 transition-colors focus:outline-none focus:ring-2 focus:ring-lime-400 focus:ring-offset-2 focus:ring-offset-emerald-700"
        aria-label="User menu"
      >
        <% if user_signed_in? %>
          <!-- User initials or avatar -->
          <span class="text-white font-semibold text-sm">
            <%= current_user.name.split.map(&:first).join.upcase[0..1] %>
          </span>
        <% else %>
          <!-- Empty circle icon for guests -->
          <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
          </svg>
        <% end %>
      </button>

      <!-- Dropdown Menu -->
      <div
        data-dropdown-target="menu"
        role="menu"
        aria-hidden="true"
        class="hidden absolute top-full right-0 mt-2 w-48 bg-white rounded-md shadow-xl border border-gray-200 py-1 z-50"
      >
        <% if user_signed_in? %>
          <!-- Authenticated User Menu -->
          <div class="px-4 py-2 text-xs font-semibold text-gray-500 uppercase tracking-wider">
            Admin
          </div>
          <%= link_to admin_leagues_path, class: dropdown_item_classes do %>
            League
          <% end %>
          <%= link_to simulations_path, class: dropdown_item_classes do %>
            Simulations
          <% end %>
          <div class="border-t border-gray-200 my-1"></div>
          <%= button_to "Sign out", destroy_user_session_path, method: :delete,
              class: "w-full text-left #{dropdown_item_classes}",
              form: { class: "m-0" }
          %>
        <% else %>
          <!-- Guest User Menu -->
          <%= link_to new_user_session_path, class: dropdown_item_classes do %>
            Sign In
          <% end %>
        <% end %>
      </div>
    </div>
  </nav>
</header>
